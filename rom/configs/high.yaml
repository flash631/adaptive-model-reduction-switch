# Higher-fidelity (still laptop-friendly)
case:
  base_dir: cases/base
  work_dir: cases/high
  results_dir: results/high

openfoam:
  solver: auto
  # Smaller dt, same endTime as low by default (more steps, finer mesh).
  endTime: 5.0
  deltaT: 0.0025
  writeControl: timeStep
  writeInterval: 20         # keep field writes coarse for longer horizon
  writeFormat: ascii
  purgeWrite: 0

mesh:
  # Finer than low (low uses 0.5). 1.0 = original tutorial resolution.
  coarsen_factor: 1.0
  min_cells_per_dir: 1

export:
  run_foamToVTK: true
  vtk_fields: ["U", "p"]
  snapshot_fields: ["U", "p"]
  time_stride: 1
  max_snapshots: 200
  min_time: 0.0

rom:
  # Slightly larger ranks to reduce ROM error in high-fidelity setting.
  r_u: 16
  r_p: 12
  energy_threshold: 0.999
  ridge: 1.0e-6
  integrator: BDF
  clip_factor: 1.25
  write_stride: 20
  template_time: "0"
  max_u_mag: 10.0
  max_p_abs: 100.0
  train_p_max_abs: 200.0
  # Discard initial transient snapshots before training (stabilizes OpInf in short training windows).
  train_discard_frac: 0.30

adaptive:
  start_time: 0.0
  end_time: 5.0
  # Longer training improves ROM generalization while remaining laptop-friendly.
  train_window: 0.3
  rom_horizon: 1.0
  validate_every: 20
  # Validation bursts start from ROM-written states; use multiple FOM steps so pressure/flux can relax.
  validate_steps: 20
  # Relaxed tolerance to ensure at least one accepted ROM segment in the high case
  # (pressure errors are typically larger without dedicated stabilization).
  tol: 2.0
  retrain_steps: 20
  # Additional safety gate: reject ROM-written states that imply absurd Cd/Cl
  # (computed from OpenFOAM forces on the cylinder patch before starting a FOM burst).
  force_gate:
    enabled: true
    discard_frac: 0.30
    cd_factor_max: 1.6
    cd_abs_max: 50.0
    cl_rms_factor_max: 2.5
    cl_abs_max: 50.0
  # Each cycle advances ~validate_every*deltaT (plus validation/retrain windows).
  # Keep this high enough to cover end_time without premature termination.
  max_cycles: 250
